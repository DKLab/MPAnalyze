function manage( moduleFile )
%MANAGE Summary of this function goes here
%   Detailed explanation goes here

% check if the provided file is valid
if MPBus.verifyFile(moduleFile, '.mat')
    loadedData = load(moduleFile, 'modules');
else
    % invalid module file, create a new one
    loadedData.modules = [];
end

handles = createGUI(loadedData.modules);

guidata(handles.main, handles);

end

function installMod(hObject, eventdata)
    disp('running install');
end


function handles = createGUI(modData)
    handles.main = figure(...
        'Color',[0.941176470588235 0.941176470588235 0.941176470588235],...
        'Colormap',[0 0 0.5625;0 0 0.625;0 0 0.6875;0 0 0.75;0 0 0.8125;0 0 0.875;0 0 0.9375;0 0 1;0 0.0625 1;0 0.125 1;0 0.1875 1;0 0.25 1;0 0.3125 1;0 0.375 1;0 0.4375 1;0 0.5 1;0 0.5625 1;0 0.625 1;0 0.6875 1;0 0.75 1;0 0.8125 1;0 0.875 1;0 0.9375 1;0 1 1;0.0625 1 1;0.125 1 0.9375;0.1875 1 0.875;0.25 1 0.8125;0.3125 1 0.75;0.375 1 0.6875;0.4375 1 0.625;0.5 1 0.5625;0.5625 1 0.5;0.625 1 0.4375;0.6875 1 0.375;0.75 1 0.3125;0.8125 1 0.25;0.875 1 0.1875;0.9375 1 0.125;1 1 0.0625;1 1 0;1 0.9375 0;1 0.875 0;1 0.8125 0;1 0.75 0;1 0.6875 0;1 0.625 0;1 0.5625 0;1 0.5 0;1 0.4375 0;1 0.375 0;1 0.3125 0;1 0.25 0;1 0.1875 0;1 0.125 0;1 0.0625 0;1 0 0;0.9375 0 0;0.875 0 0;0.8125 0 0;0.75 0 0;0.6875 0 0;0.625 0 0;0.5625 0 0],...
        'DockControls','off',...
        'IntegerHandle','off',...
        'MenuBar','none',...
        'Name','Manage Modules',...
        'NumberTitle','off',...
        'PaperPosition',get(0,'defaultfigurePaperPosition'),...
        'Position',[544 112 489 513],...
        'HandleVisibility','callback',...
        'UserData',[],...
        'Tag','figure1',...
        'Visible','on' );

    nMods = length(modData);
    cellData = cell(nMods, 3);
    for index = 1 : nMods
        cellData{ index, 1 } = modData(index).moduleName;
        cellData{ index, 2 } = modData(index).functionPath;
        cellData{ index, 3 } = [ modData(index).functionName '.m' ];
    end 
    columnName = {'Module Name', 'Path', 'File'};
    columnEditable = [true false false];
    columnWidth = {125, 130, 130};
    handles.table_modules = uitable(...
        'Parent', handles.main, ...
        'Units', 'normalized', ...
        'Position', [0.1 0.3 0.8 0.4], ...
        'Data', cellData, ...
        'ColumnName', columnName, ...
        'ColumnEditable', columnEditable, ...
        'ColumnWidth', columnWidth, ...
        'RowName', [], ...
        'Tag', 'table_modules');
    
%%%%%%% BEGIN CONTROL PANEL   
    handles.panel_controls = uipanel(...
        'Parent', handles.main, ...
        'Units', 'normalized', ...
        'Position', [0.1 0.75 0.8 0.15], ...
        'Clipping', 'on' );
    
    handles.button_remove = uicontrol(...
        'Parent', handles.panel_controls, ...
        'Units', 'normalized', ...
        'Position', [0.075 0.25 0.25 0.45], ...
        'String', 'Remove Selected' );
    
    handles.button_install = uicontrol(...
        'Parent', handles.panel_controls, ...
        'Units', 'normalized', ...
        'Position', [0.375 0.25 0.25 0.45], ...
        'String', 'Install...', ...
        'Callback', @installMod);
    
    handles.button_undo = uicontrol(...
        'Parent', handles.panel_controls, ...
        'Units', 'normalized', ...
        'Position', [0.675 0.25 0.25 0.45], ...
        'String', 'Undo Changes' );
%%%%%%%%%% END CONTROL PANEL

    handles.button_save = uicontrol(...
        'Parent', handles.main, ...
        'Units', 'normalized', ...
        'Position', [0.2 0.15 0.25 0.07], ...
        'String', 'Save and Exit' );
    
    handles.button_cancel = uicontrol(...
        'Parent', handles.main, ...
        'Units', 'normalized', ...
        'Position', [0.55 0.15 0.25 0.07], ...
        'String', 'Cancel' );
end